---
title: "MiniProyecto"
author: "Sergio Marín Castro // Laura Isabel Montoliu Peris // Beatriz Perello Osborne // Gonzalo Sanchez Muñoz"
date: "11/4/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# cargamos las librerías necesarias

library(readr)
library(dplyr)
library(tidyr)
library(stringr)
library(lubridate)
library(ggplot2)
library(paletteer)
library(plotly)

```

# Paso 3

Descargamos los ficheros de datos y los almacenamos en una carpeta, llamada 'data'.


SIGNIFICADO DE LAS VARIABLES

recvTime : Fecha en la que se inserto el dato en la plataforma
FiwareServicePath : Servicio al que pertenece el sensor
EntityType : Tipo de sensor
EntityId : Identificador único del sensor
LAeq : En este caso el período establecida para este sensor es de 1 minuto
LAeq_d: Es un indicador de ruido durante el dia desde las 7 hasta las 19 horas.(12h)
LAeq_den: Indice de ruido día-tarde-noche, para determinar la molestia vinculada a la exposición al ruido.
LAeq_e: Es un indicador del nivel sonoro durante la tarde desde las 19 hasta las 23 horas.(4h)
LAeq_n: Es un indicador del nivel sonoro durante la noche desde las 23 hasta las 7 horas.(8h)
Dateobserved: Día al que se refieren las medidas.

# Paso 4

Este paso consiste en importar y fusionar todos los datos en un solo dataframe ("RUZAFA"), además debemos realizar una exploración inicial de los datos.
Para ello vamos a importar todos los ficheros de datos descargados anteriormente, creando una variable con el dataframe de dichos ficheros.

```{r}
# importamos ficheros en data frames
VivChafCadz <- read_csv("data/ VivonsChaflánCádiz.csv", show_col_types = FALSE)
Cadiz3 <- read_csv("data/Cadiz3.csv", show_col_types = FALSE)
Cadiz16 <- read_csv("data/Cadiz16.csv", show_col_types = FALSE)
CarlCerv34 <- read_csv("data/CarlesCervera34.csv", show_col_types = FALSE)
CarlCervChaf <- read_csv("data/CarlesCervera Chaflán.csv", show_col_types = FALSE)
Cuba3 <- read_csv("data/Cuba3.csv", show_col_types = FALSE)
DoctorSerrano21 <- read_csv("data/DoctorSerrano21.csv", show_col_types = FALSE)
GeneralPrim <- read_csv("data/GeneralPrim.csv", show_col_types = FALSE)
PuertoRico21 <- read_csv("data/PuertoRico21.csv", show_col_types = FALSE)
SalvAbrilChaf <- read_csv("data/SalvadorAbrilChaflán.csv", show_col_types = FALSE)
Sueca2 <- read_csv("data/Sueca2.csv", show_col_types = FALSE)
Sueca32 <- read_csv("data/Sueca32.csv", show_col_types = FALSE)
Sueca61 <- read_csv("data/Sueca61.csv", show_col_types = FALSE)
SuecaEsqDenia <- read_csv("data/SuecaEsqDenia.csv", show_col_types = FALSE)
```

Para una clara exploración debemos unir los dataframes, creando así uno más grande con toda la información 'RUZAFA'

```{r}
# unimos los data frames
RUZAFA <- VivChafCadz %>% 
  full_join(Cadiz3) %>%
  full_join(Cadiz16) %>%
  full_join(CarlCervChaf) %>% 
  full_join(CarlCerv34) %>% 
  full_join(Cuba3) %>% 
  full_join(DoctorSerrano21) %>% 
  full_join(GeneralPrim)  %>% 
  full_join(PuertoRico21) %>% 
  full_join(SalvAbrilChaf)%>% 
  full_join(Sueca2 )%>% 
  full_join(Sueca32) %>% 
  full_join(Sueca61) %>% 
  full_join(SuecaEsqDenia)

View(RUZAFA)

```

Vamos a realizar la primera exploración inicial. 
Para ello vamos a ver sus dimensiones, nombres de variables, mayor y menos fecha observada...

```{r}
# exploración inicial
dim(RUZAFA)
names(RUZAFA)
summary(RUZAFA)
str(RUZAFA)
attach(RUZAFA)

max(dateObserved)
min(dateObserved)

RUZAFA%>%
  group_by(Año = year(dateObserved))%>%
  summarise(min= min(dateObserved) ,max = max(dateObserved))

table(entityType)
table(fiwareServicePath)

# realizamos un gráfico para ver de manera más visual la información sobre los
# días de estudio y las calles
table(entityId)
ggplot(RUZAFA, aes(entityId, fill =factor(year(dateObserved)))) + geom_bar() +theme(axis.text.x = element_text(angle = 90, hjust = 1))+labs(x="Calles",y = "dias", title="Dias de estudio por calle") + guides(fill = guide_legend(title = "Años"))
detach(RUZAFA)

```

Mediante estas funciones hemos observado varias cosas a destacar sobre la información.

Como por ejemplo, vemos que solo hay un tipo de sensor y servicio al que pertencen los datos.

Utilizando las funciones $max()$ y $min()$ vemos que los datos se han reocgido desde 2020-09-17 hasta 2022-04-10.

Tambiém vemos que el año 2021 esta completo, es decir, la última fecha en la que se ha recogido información es el último día del año. Mientras que en los otros dos, 2020 y 2022, la última recogida de información no es el último día del año.

Por último, gracias al gráfico vemos que en una calle de las registradas no hay información sobre el año 2022.


Posibles preguntas que se pueden plantear y se pueden resolver con los datos proporcionados.

- PREGUNTAS:
HILO DE LA PRESENTACION-->
Un señor que no esta seguro si comprarse una casa en Ruzafa y que tampoco sabe cual seria la mejor calle para vivir, nos ha planteado las siguientes preguntas:

1.¿Cual es la calle que mas ha molestado a los vecinos en en los tres ultimos años?¿Y la que menos?(Laura)
2.¿En que calle ha incrementado mas el ruido a lo largo del año 2022? (Laura)
3.¿La sonoridad en Ruzafa ha ido aumentado o disminuyendo a lo largo del tiempo?
4.¿El covid afectó en algo? ¿Y las fallas? ¿Y la Navidad?
5.¿Que calles han sido las mas ruidosas durante el dia, la tarde, y la noche? ¿Y las que menos?
6.¿Cuál es la calle que más MOLESTÓ a los vecinos sin contar los meses de verano? ¿Y la que menos?
7.¿En que mes ha habido mas acumulación de ruido en Ruzafa en cada año?
8.¿Que calles son las mas tranquilas para vivir en cada estacion de año?
9.¿En que calle hay mas ruido los fines de semana en 2022? ¿Hay alguna relacion con la mas ruidosa por la noche?
10.¿En que dia de la semana ha habido mas ruido por calle?¿Y en general?
11. Hay que hacer analisis univariante y bivariante
12. Analizar los datos faltantes

RESPUESTA:
En conclusion la calle que le recomendamos mas para vivir es: .... y la que menos es: .....

# Paso 5

Para obtener un tidy dataset, es decir, un dataframe más representativo y claro, vamos a modificar los nombres de las columnas por unos más adecuados.
Además de modificar los nombres de las columnas vamos a realizar ciertas operaciones para dejar un tidy dataset, como por ejemplo, eliminar las columnas que no son de utilidad, asegurarnos de que hay 1 única variable por columna, eliminar o sustituir datos faltantes o datos incorrectos...

```{r}
# Modificamos nombres de columnas
colnames(RUZAFA) # miramos los nombres que tiene el dataframe
colnames(RUZAFA) <- c("Id", "Fecha_Registro", "Servicio_Sensor", "Tipo_Entidad_Sensor", "Id_Sensor",
                      "Nivel_Sonoro_Continuo", "Nivel_Sonoro_Dia", "Nivel_Sonoro_dtn", # dtn - dia, tarde y noche
                      "Nivel_Sonoro_Tarde", "Nivel_Sonoro_Noche", "Dia_Medicion", "Nombre_Calle")

# Ahora eliminamos las columnas que no nos interesan
RUZAFA1 <- RUZAFA %>% select(-Servicio_Sensor, -Tipo_Entidad_Sensor) 

# Para que sea un conjunto tidy debe de haber una variable por cada columna, 
# en este caso los niveles sonoros estan en varias columnas
RUZAFA_TIDY2 <- RUZAFA1 %>% gather(Nivel_Sonoro, Valores, 4:8)

# Ahora vemos si hay datos faltantes o incorrectos y los sustituimos
# Se puede ver que hay dos valores "Inf" y los sustituiremos por los valores mas 
# frecuentes(media)
breaks <- c(min(RUZAFA_TIDY2$Valores), 0, 5, max(RUZAFA_TIDY2$Valores))
ggplot(RUZAFA_TIDY2, aes(Valores)) + geom_histogram(bins=30)
RUZAFA_TIDY2 %>% count(Valores)
RUZAFA_TIDY2 %>% filter(Valores != "Inf") %>% summarise(Media = mean(Valores))#Media 60.4
RUZAFA_TIDY <- RUZAFA_TIDY2 %>% mutate(Valores = ifelse(Valores ==  "Inf", 60.4, Valores)) %>% mutate(Nivel_Sonoro = as.factor(Nivel_Sonoro)) #y convertimos la columna Nivel_Sonoro en factores .
View(RUZAFA_TIDY)


# Por ultimo separamos la columna Fecha Registro, ya que tiene dos variables 
# una de fecha y otra de tiempo
RUZAFA_TIDY = RUZAFA_TIDY %>%
              separate(Fecha_Registro, into=c("Fecha_Registro","Hora_Registro"), sep=10) %>% mutate(Fecha_Registro = as.Date(Fecha_Registro))
str(RUZAFA_TIDY)

# No es tidy pero tambien añadimos la columna calles para que sea mas facil de 
# entender los resultados
# Seleccionamos la columna de Id_sensor
Id_Sensor = RUZAFA_TIDY %>% select(Id_Sensor)

# Creamos la columna Calles
RUZAFA_TIDY = RUZAFA_TIDY %>%  
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248655-daily", "Cadiz3 ", Id_Sensor))%>% 
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248677-daily" , "VivChafCadz", Id_Sensor))%>% 
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248671-daily" , " Cadiz16 ", Id_Sensor))%>%
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248670-daily" , "CarlCervChaf", Id_Sensor))%>% 
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248678-daily" , "CarlCerv34 ", Id_Sensor)) %>% 
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248682-daily" , "Cuba3", Id_Sensor)) %>% 
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248669-daily" , "DoctorSerrano21", Id_Sensor))%>% 
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248682-daily" , "Cuba3", Id_Sensor)) %>% 
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248672-daily" , "PuertoRico21", Id_Sensor))%>% 
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248676-daily" , "SalvAbrilChaf", Id_Sensor))%>% 
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248683-daily", "Sueca2" , Id_Sensor))%>% 
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248680-daily" , "Sueca32", Id_Sensor))%>% 
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248684-daily","Sueca61", Id_Sensor))%>%
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248652-daily","SuecaEsqDenia",  Id_Sensor))%>% 
  mutate(Id_Sensor = ifelse(Id_Sensor == "T248661-daily" , "GeneralPrim",  Id_Sensor))  

colnames(RUZAFA_TIDY) <- c("Id", "Fecha_Registro", "Hora_Registro", "Calles", "Dia_Medicion", "Nivel_Sonoro", "Valores")

# Ahora se une el data frame con las calles y el dat frame con Id_Sensores
RUZAFA_TIDY = cbind(RUZAFA_TIDY, Id_Sensor)

# Por ultimo ordenamos de nuevo las columnas
RUZAFA_TIDY = RUZAFA_TIDY [ , c(1,8,2,3,4,6,7,5)]
```

# Paso 6

PREGUNTA 1
```{r}
#1.¿Cual es la calle que mas ha molestado a los vecinos en en los tres ultimos años?¿Y la que menos?

######################################  LA QUE MAS  #######################################

#Seleccionamos la calle con mas ruido de cada año
Año2020 = RUZAFA_TIDY %>% group_by(Calles) %>% filter(year(Dia_Medicion) == "2020") %>% summarise(MaxRuido = mean(Valores)) %>% filter(MaxRuido == max(MaxRuido))

Año2021 = RUZAFA_TIDY %>% group_by(Calles) %>% filter(year(Dia_Medicion) == "2021") %>% summarise(MaxRuido = mean(Valores)) %>% filter(MaxRuido == max(MaxRuido))

Año2022 =  RUZAFA_TIDY %>% group_by(Calles) %>% filter(year(Dia_Medicion) == "2022") %>% summarise(MaxRuido = mean(Valores)) %>% filter(MaxRuido == max(MaxRuido))

#Los unimos y creamos un nuevo data frame
MaxMolestia = rbind(Año2020, Año2021, Año2022)
#Añadimos la columna de años y lo convertimos en factor
MaxMolestia = MaxMolestia %>% mutate(Año = c(2020, 2021, 2022)) %>% mutate(Año = as.factor(Año))
MaxMolestia

#Por ultimo representamos las calles que mas han molestado a los vecinos en los ultimos 3 años
a =ggplot(MaxMolestia, aes(Año, MaxRuido, color = Calles, size = MaxRuido)) + geom_point(shape = 3, size=5) + ggtitle("Calles con mayor nivel de ruido de media por año")+scale_y_continuous(limits = c(53,67),name = "Nivel de ruido") 
a
#En conclusion podemos ver que la calle que más ha molestado a los vecinos en 2020, 2021 y 2022 es la misma, Cadiz3

#######################################  LA QUE MENOS   ###################################

Año2020 = RUZAFA_TIDY%>% group_by(Calles) %>% filter(year(Dia_Medicion) == "2020") %>% summarise(MinRuido = mean(Valores)) %>% filter(MinRuido == min(MinRuido))

Año2021 = RUZAFA_TIDY%>% group_by(Calles) %>% filter(year(Dia_Medicion) == "2021") %>% summarise(MinRuido = mean(Valores)) %>% filter(MinRuido == min(MinRuido))

Año2022 =  RUZAFA_TIDY%>% group_by(Calles) %>% filter(year(Dia_Medicion) == "2022") %>% summarise(MinRuido = mean(Valores)) %>% filter(MinRuido == min(MinRuido))

#Los unimos y creamos un nuevo data frame
MinMolestia = rbind(Año2020, Año2021, Año2022)
#Añadimos la columna de años y lo convertimos en factor
MinMolestia = MinMolestia %>% mutate(Año = c(2020, 2021, 2022)) %>% mutate(Año = as.factor(Año))

#Por ultimo representamos las calles que mas han molestado a los vecinos en los ultimos 3 años
b =ggplot(MinMolestia, aes(Año, MinRuido, color = Calles, size=MinRuido)) + geom_point(shape = 10, size = 5)+ ggtitle("Calles con menor nivel de ruido de media por año")+scale_y_continuous(limits = c(53,67),name = "Nivel de ruido") 
b
#En conclusion podemos ver que la calle que menos ha molestado a los vecinos en 2020, 2021 y 2022 es la misma, GeneralPrim

```

PREGUNTA 2

```{r}
#2.¿En que calle ha incrementado mas el ruido a lo largo del año 2022?
RUZAFA_TIDY2 = RUZAFA_TIDY %>% filter(year(Dia_Medicion) == "2022") %>% group_by(Calles)
RUZAFA_TIDY2 = RUZAFA_TIDY2%>%
              select(Calles, Valores, Dia_Medicion)
ggplot(RUZAFA_TIDY2, aes(Dia_Medicion, Valores)) + geom_line() + facet_wrap(~Calles)+geom_smooth(method = 'lm')

#SOLUCION: Se puede ver que el nivel Sonoro de cada calle a lo largo de 2022 (enero-marzo) no varía notablemente excepto en el mes de marzo que en todas las calles el nivel aumenta.

```

PREGUNTA 3
```{r}
#3.¿La sonoridad en Ruzafa ha ido aumentado o disminuyendo a lo largo del tiempo?
#¿El covid afectó en algo? ¿Y las fallas? ¿Y la Navidad?
RUZAFA_TIDY3_1 = RUZAFA_TIDY %>% select(Dia_Medicion, Calles, Valores) %>% group_by(year(Dia_Medicion)) %>% filter(year(Dia_Medicion) == "2020")
ggplot(RUZAFA_TIDY3_1, aes(Dia_Medicion, Valores, color = month(Dia_Medicion)))+ geom_line() + geom_smooth(color="darkgrey")

RUZAFA_TIDY3_2 = RUZAFA_TIDY %>% select(Dia_Medicion, Calles, Valores) %>% group_by(year(Dia_Medicion)) %>% filter(year(Dia_Medicion) == "2021")
ggplot(RUZAFA_TIDY3_2, aes(Dia_Medicion, Valores, color = month(Dia_Medicion)))+ geom_line() + scale_y_continuous(limits=c(40,100)) + geom_smooth(color="darkgrey")

RUZAFA_TIDY3_3 = RUZAFA_TIDY %>% select(Dia_Medicion, Calles, Valores) %>% group_by(year(Dia_Medicion)) %>% filter(year(Dia_Medicion) == "2022")

ggplot(RUZAFA_TIDY3_3, aes(Dia_Medicion, Valores, color = month(Dia_Medicion)))+ geom_line() + scale_y_continuous(limits=c(40,100)) + geom_smooth(color="darkgrey")


```

```{r}
#POR LA NOCHE TODAS LAS CALLES NE UN GRAFICO
#Relacionar luego max ruido con max noche
dat = RUZAFA_TIDY %>% filter(Nivel_Sonoro == "Nivel_Sonoro_Noche") 

#COLS = c("gray", "pink", "blue", "#5CB85C", "yellow", "orange", "purple", "black", "turquese", "brown", "green", "red", )
ggplot(dat, aes(x = Dia_Medicion, y = Valores, color = Calles)) + geom_line(position = "jitter") + scale_color_discrete(labels = c("Calle 1", "Calle 2",  "Calle 3",  "Calle 4",  "Calle 5",  "Calle 6",  "Calle 7",  "Calle 8",  "Calle 9",  "Calle 10",  "Calle 11",  "Calle 12",  "Calle 13",  "Calle 14" )) + facet_wrap(~Calles)

ggplot(dat, aes(x = Dia_Medicion, y = Valores, color = Calles)) + geom_line(position = "jitter") + scale_color_discrete(labels = c("Calle 1", "Calle 2",  "Calle 3",  "Calle 4",  "Calle 5",  "Calle 6",  "Calle 7",  "Calle 8",  "Calle 9",  "Calle 10",  "Calle 11",  "Calle 12",  "Calle 13",  "Calle 14" )) 

dat= dat%>%group_by(Calles, Mes = month(Dia_Medicion)) %>% summarise(Max = max(Valores)) %>% mutate(Mes = ifelse(Mes == 1, "enero",Mes)) %>% mutate(Mes = ifelse(Mes == 2, "febrero",Mes)) %>% mutate(Mes = ifelse(Mes == 3, "marzo",Mes)) %>% mutate(Mes = ifelse(Mes == 4, "abril",Mes)) %>% mutate(Mes = ifelse(Mes == 5, "mayo",Mes)) %>% mutate(Mes = ifelse(Mes == 6, "junio",Mes)) %>% mutate(Mes = ifelse(Mes == 7, "julio",Mes)) %>% mutate(Mes = ifelse(Mes == 8, "agosto",Mes)) %>% mutate(Mes = ifelse(Mes == 9, "septiembre",Mes)) %>% mutate(Mes = ifelse(Mes == 10, "octubre",Mes)) %>% mutate(Mes = ifelse(Mes == 11, "noviembre",Mes)) %>% mutate(Mes = ifelse(Mes == 12, "diciembre",Mes))
dat
```


PREGUNTA 4
```{r}
#4.¿Que calles han sido las mas ruidosas durante el dia, la tarde, y la noche? ¿Y las que menos?


```

PREGUNTA 5
```{r}
#5.¿Suele haber mas silencio por la tarde o durante el dia en Ruzafa?

```

PREGUNTA 6
```{r}
#¿Cuál es la calle que más MOLESTÓ a los vecinos sin contar los meses de verano? ¿Y la que menos?
#Suponemos meses de verano como: Junio,Julio y Agosto.

################################ MÁS MOLESTIA ######################################
ENERO = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "1") %>% summarise(MaxRuido = mean(Valores)) %>% filter(MaxRuido == max(MaxRuido))

FEBRERO = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "2") %>% summarise(MaxRuido = mean(Valores)) %>% filter(MaxRuido == max(MaxRuido))

MARZO = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "3") %>% summarise(MaxRuido = mean(Valores)) %>% filter(MaxRuido == max(MaxRuido))

ABRIL = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "4") %>% summarise(MaxRuido = mean(Valores)) %>% filter(MaxRuido == max(MaxRuido))

MAYO = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "5") %>% summarise(MaxRuido = mean(Valores)) %>% filter(MaxRuido == max(MaxRuido))

SEPTIEMBRE = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "9") %>% summarise(MaxRuido = mean(Valores)) %>% filter(MaxRuido == max(MaxRuido))

OCTUBRE = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "10") %>% summarise(MaxRuido = mean(Valores)) %>% filter(MaxRuido == max(MaxRuido))

NOVIEMBRE = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "11") %>% summarise(MaxRuido = mean(Valores)) %>% filter(MaxRuido == max(MaxRuido))

DICIEMBRE = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "12") %>% summarise(MaxRuido = mean(Valores)) %>% filter(MaxRuido == max(MaxRuido))

#Los unimos y creamos un nuevo data frame
MaxMolNoVe = rbind(ENERO,FEBRERO,MARZO,ABRIL,MAYO,SEPTIEMBRE,OCTUBRE,NOVIEMBRE,DICIEMBRE)
#Añadimos la columna de años y lo convertimos en factor
MaxMolNoVe = MaxMolNoVe %>% mutate(Mes = c("ENERO","FEBRERO","MARZO","ABRIL","MAYO","SEPTIEMBRE","OCTUBRE","NOVIEMBRE","DICIEMBRE")) %>% mutate(Mes= as.factor(Mes))

#Por ultimo representamos las calles que mas han molestado a los vecinos en los ultimos 3 años
maxnove =ggplot(MaxMolNoVe, aes(Mes, MaxRuido, color = Calles, size=MaxRuido)) + geom_point(shape = 8, size = 4,)+ ggtitle("Calles con mayor nivel de ruido de media por mes sin verano")+scale_y_continuous(limits = c(45,85),name = "Nivel de ruido") 
maxnove
#La calle que más ha molestado a los vecinos en la mayoría de meses es Cadiz,3 excepto en Marzo que fue la de Sueca,32.


################################ MENOS MOLESTIA ######################################
ENERO2 = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "1") %>% summarise(MinRuido = mean(Valores)) %>% filter(MinRuido == min(MinRuido))

FEBRERO2 = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "2") %>% summarise(MinRuido = mean(Valores)) %>% filter(MinRuido == min(MinRuido))

MARZO2 = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "3") %>% summarise(MinRuido = mean(Valores)) %>% filter(MinRuido == min(MinRuido))

ABRIL2 = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "4") %>% summarise(MinRuido = mean(Valores)) %>% filter(MinRuido == min(MinRuido))

MAYO2 = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "5") %>% summarise(MinRuido = mean(Valores)) %>% filter(MinRuido == min(MinRuido))

SEPTIEMBRE2 = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "9") %>% summarise(MinRuido = mean(Valores)) %>% filter(MinRuido == min(MinRuido))

OCTUBRE2 = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "10") %>% summarise(MinRuido = mean(Valores)) %>% filter(MinRuido == min(MinRuido))

NOVIEMBRE2 = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "11") %>% summarise(MinRuido = mean(Valores)) %>% filter(MinRuido == min(MinRuido))

DICIEMBRE2 = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "12") %>% summarise(MinRuido = mean(Valores)) %>% filter(MinRuido == min(MinRuido))

#Los unimos y creamos un nuevo data frame
MinMolNoVe = rbind(ENERO2,FEBRERO2,MARZO2,ABRIL2,MAYO2,SEPTIEMBRE2,OCTUBRE2,NOVIEMBRE2,DICIEMBRE2)
#Añadimos la columna de años y lo convertimos en factor
MinMolNoVe = MinMolNoVe %>% mutate(Mes = c("ENERO","FEBRERO","MARZO","ABRIL","MAYO","SEPTIEMBRE","OCTUBRE","NOVIEMBRE","DICIEMBRE")) %>% mutate(Mes= as.factor(Mes))

#Por ultimo representamos las calles que mas han molestado a los vecinos en los ultimos 3 años
MinMol =ggplot(MinMolNoVe, aes(Mes, MinRuido, color = Calles, size=MinRuido)) + geom_point(shape = 8, size = 4,)+ ggtitle("Calles con mayor nivel de ruido de media por mes sin verano")+scale_y_continuous(limits = c(20,70),name = "Nivel de ruido") 
MinMol
#La calle que menos ha molestado a los vecinos en todos los meses que no son verano ha sido la Calle Genral Prim.
```


PREGUNTA 7
```{r}
#7.¿Que calles son las mas tranquilas para vivir en cada estación del año?
################################ VERANO ######################################
#Para el verano tomamos Agosto y junio que son los meses de los que tenemos datos.
JUNIO2 = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "6") %>% summarise(MinRuido = mean(Valores)) %>% filter(MinRuido == min(MinRuido))

AGOSTO2 = RUZAFA_TIDY %>% group_by(Calles) %>% filter(month(Dia_Medicion) == "8") %>% summarise(MinRuido = mean(Valores)) %>% filter(MinRuido == min(MinRuido))

#Los unimos y creamos un nuevo data frame
MinMolverano = rbind(JUNIO2,AGOSTO2)
#Añadimos la columna de años y lo convertimos en factor
MinMolverano = MinMolverano %>% mutate(Mes = c("JUNIO","AGOSTO")) %>% mutate(Mes= as.factor(Mes))
MinMolverano =ggplot(MinMolverano, aes(Mes, MinRuido, color = Calles, size=MinRuido)) + geom_point(shape = 8, size = 4,)+ ggtitle("Calles con mayor nivel de ruido de media en verano")+scale_y_continuous(limits = c(20,80),name = "Nivel de ruido") 
MinMolverano
#La calle más tranquila para el verano es General Prim.

################################ OTOÑO ######################################
#Para el otoño tomamos Septiembre, Octubre, Noviembre y Diciembre.

#Los unimos y creamos un nuevo data frame
MinMolOTOÑO = rbind(SEPTIEMBRE2,OCTUBRE2,NOVIEMBRE2,DICIEMBRE2)
#Añadimos la columna de años y lo convertimos en factor
MinMolOTOÑO = MinMolOTOÑO %>% mutate(Mes = c("SEPTIEMBRE","OCTUBRE","NOVIEMBRE","DICIEMBRE")) %>% mutate(Mes= as.factor(Mes))
MinMolOTOÑO =ggplot(MinMolOTOÑO, aes(Mes, MinRuido, color = Calles, size=MinRuido)) + geom_point(shape = 8, size = 4,)+ ggtitle("Calles con mayor nivel de ruido de media en otoño.")+scale_y_continuous(limits = c(20,80),name = "Nivel de ruido") 
MinMolOTOÑO
#La calle más tranquila para el otoño es General Prim.

################################ INVIERNO ######################################
#Para el invierno tomamos Enero, Febrero y Marzo.

#Los unimos y creamos un nuevo data frame
MinMolINV = rbind(ENERO2,FEBRERO2,MARZO2)
#Añadimos la columna de años y lo convertimos en factor
MinMolINV = MinMolINV %>% mutate(Mes = c("ENERO","FERBREO","MARZO")) %>% mutate(Mes= as.factor(Mes))
MinMolINV =ggplot(MinMolINV, aes(Mes, MinRuido, color = Calles, size=MinRuido)) + geom_point(shape = 8, size = 4,)+ ggtitle("Calles con mayor nivel de ruido de media en invierno")+scale_y_continuous(limits = c(20,80),name = "Nivel de ruido") 
MinMolINV
#La calle más tranquila para el invierno es General Prim.

################################ PRIMAVERA ######################################
#Para la primavera tomamos Abril y Mayo.

#Los unimos y creamos un nuevo data frame
MinMolPRIM = rbind(ABRIL2,MAYO2)
#Añadimos la columna de años y lo convertimos en factor
MinMolPRIM = MinMolPRIM %>% mutate(Mes = c("ABRIL","MAYO")) %>% mutate(Mes= as.factor(Mes))
MinMolPRIM =ggplot(MinMolPRIM, aes(Mes, MinRuido, color = Calles, size=MinRuido)) + geom_point(shape = 8, size = 4,)+ ggtitle("Calles con mayor nivel de ruido de media en primavera")+scale_y_continuous(limits = c(20,80),name = "Nivel de ruido") 
MinMolPRIM
#La calle más tranquila para la primavera es General Prim.
```
Conclusión:
La calle más tranquila para todas las estaciones del año es la Calle General Prim.

PREGUNTA 8
```{r}
#8.¿En que calle hay mas ruido los fines de semana en 2022? ¿Hay alguna relacion con la mas ruidosa por la noche?

```


PREGUNTA 9
```{r}
#9.¿En que dia de la semana ha habido mas ruido por calle?¿Y en general?

```

PREGUNTA 10
```{r}

#11. Hay que hacer analisis univariante y bivariante


```

PREGUNTA 11
```{r}
#12. Analizar los datos faltantes

```
<<<<<<< HEAD




=======
>>>>>>> 23675c8b6da8d5e455990d66835ae1bb83411c7c



```{r}
df <- RUZAFA %>% gather(key= "tipo_medida", value = "valor", 6:10)


total = df %>% group_by(tipo_medida, Dia_Medicion) %>% 
  summarise(valor = mean(valor)) %>% 
  select(Dia_Medicion,tipo_medida,valor)


meses = c("enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiempre","octubre","noviembre","diciembre")
grafico = total %>%
  #Se añade la columna con el día de la semana
  mutate(mes_num = month(Dia_Medicion)) %>%
  #Se utiliza solo el nivel sonoro equivalente
  filter(tipo_medida == "Nivel_sonoro_continuo_equivalente") %>%
  #Se elimina la columna dia medición
  select(-Dia_Medicion) %>%
  #Se agrupa por dia y el tipo de medida para hacer una columna de valor una media
  group_by(mes_num, tipo_medida) %>%
  mutate(valor = mean(valor)) %>%
  #Se eliminan los repetidos
  unique() %>%
  #Se hace una columna con el mes
  mutate(mes = meses[mes_num]) %>%
  mutate(mes = factor(mes,ordered = T, levels = meses)) %>%
  #Se hace el gráfico en función del tipo del mes
  ggplot(aes(x = mes, y = valor, fill = mes)) + 
  geom_bar(stat="identity") + 
  theme(legend.position="none",axis.text.x = element_text(angle = 45,hjust = 1, vjust = 1)) + 
  coord_cartesian(ylim = c(55,65)) +
  labs(title = "Distribución del sonido en función del mes", x = "Mes", y = "Nivel sonoro equivalente", caption = "Fijarse en el
       eje y")

ggplotly(grafico, height = 350, width=600)
```





